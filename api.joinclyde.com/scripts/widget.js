var Clyde=function(){function a(t,e){var o=new XMLHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Authorization",b),!0!==V&&o.setRequestHeader("X-Clyde-Source","widget"),o.onload=e,o.onerror=function(e){console.error("Something is wrong with "+t,e)},o.send()}function r(e){var t=new XMLHttpRequest;t.open("POST",n,!0),t.setRequestHeader("Authorization",b),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!0!==V&&t.setRequestHeader("X-Clyde-Source","widget"),t.onerror=function(e){console.error("Something is wrong with analytics request ",e)},e+="&source=widget",e+="&client_date="+new Date,t.send(e)}function i(e,t){var o;U?(o=function(){k=e?{sku:e,contracts:x[e]}:void 0,w=null,_(),D(),"function"==typeof t&&t()},e?x[e]?(0===x[e].length&&j&&console.warn("Clyde warning: contracts not found for sku "+e),o()):J(e,o):o()):console.error("Clyde widget not ready yet, did you initialize?")}function c(t,e){if(U)if(k){var o;if(k.contracts.forEach(function(e){e.attributes.sku===t&&(o=e)}),o){switch(w={sku:t,recommendedPrice:o.attributes.recommendedPrice},S.platform){case"shopify":w.shopifyVariantId=o.attributes.shopifyVariantId;break;case"bigcommerce":w.bcProductId=o.attributes.bcProductId,w.bcVariantId=o.attributes.bcVariantId,w.coveredProductCode=o.attributes.coveredProductCode}switch(e){case"product":Q("selectContract",{sku:w.sku},"modal");break;case"modal":Q("selectContract",{sku:w.sku},"product");break;default:Q("selectContract",{sku:w.sku},"modal"),Q("selectContract",{sku:w.sku},"product")}return"function"==typeof q&&q(w),k&&k.sku&&w&&w.sku&&r("action=select_contract&fromWhere="+e+"&selectedContractSKU="+w.sku+"&activeProduct="+k.sku),w}console.error("This product doesn't have a contract matching the provided SKU")}else console.error("You must select a product before selecting one of its contracts.");else console.error("Clyde widget not ready yet, did you initialize?")}function s(e,t){U?B(e,t):console.error("Clyde widget not ready yet, did you initialize?")}function d(){m.style.display="none",m.classList.remove("clyde-fade-in"),"function"==typeof L?(L(),L=void 0):"function"==typeof T&&T()}var l,n,u,f,p,y,m,g,h,w,k,b,C,v,S,P,I,M,L,z,T,q,x={},E=0,R=["simple","select","list","cart"],A=0,N={},U=!1,V=!1,H=!1,K=!1,O=!1,j=!0,W=function(){h?j&&console.warn("Clyde CTA has already been appended."):((h=document.createElement("iframe")).name="clyde-widget-product-page-frame",h.id="clyde-widget-product-page-frame",h.style.height=0,h.style.margin="5px 0",h.style.border="none",h.style.width="100%",h.src=p,h.onload=function(){window.frames["clyde-widget-product-page-frame"].postMessage({type:"init",data:{type:C},origin:window.location.origin},p)},F(g,C),_(),D(),e())},e=function(){var e=document.createElement("style");e.innerText=".clyde-fade-in {opacity: 0;-webkit-animation: fadeIn ease-in 1;-moz-animation: fadeIn ease-in 1;animation: fadeIn ease-in 1;-webkit-animation-fill-mode: forwards;-moz-animation-fill-mode: forwards;animation-fill-mode: forwards;-webkit-animation-duration: .3s;-moz-animation-duration: .3s;animation-duration: .3s;}@-webkit-keyframes fadeIn {from { opacity: 0; }to { opacity: 1; }}@-moz-keyframes fadeIn {from { opacity: 0; }to { opacity: 1; }}@keyframes fadeIn {from { opacity: 0; }to { opacity: 1; }}",document.body.appendChild(e)},X=function(){var e;m?j&&console.warn("Clyde modal has already been appended."):(e=document.createElement("div"),(m=document.createElement("iframe")).name="clyde-widget-modal-frame",m.style.display="none",m.style.border="none",m.style.position="fixed",m.style.top="0",m.style.left="0",m.style.height="100%",m.style.width="100%",m.style.opacity="1",m.style.transition="opacity .4s ease",m.style.zIndex=2147483647,m.src=f,m.onload=function(){window.frames["clyde-widget-modal-frame"].postMessage({type:"init",data:{},origin:window.location.origin},f)},e.appendChild(m),document.body.appendChild(e))},G=function(n){var e,t;b||console.error("Need store key"),S?j&&console.warn("Already loaded shop config. You most likely called Clyde.init() more than once on this page."):(e=l+"/products/?includeConfig=true",v&&0<v.length&&(t=[],v.forEach(function(e){t.push(encodeURIComponent(e))}),e=e+"&sku="+t.join(",")),a(e,function(){if(200<=this.status&&this.status<400){var e=JSON.parse(this.response);S=e.meta.config,P={productPage:S.productPage,modal:S.modal,cart:S.cart,catalog:S.catalog,type:S.type},void 0===C&&(C=S.type||"select");var t={productPage:S.productPage,modal:S.modal,cart:S.cart,catalog:S.catalog};if(I&&!1===t[I])return void(j&&console.warn("This page is turned off from your dashboard"));if(v)for(var o=0;o<v.length;o++)x[v[o]]=[];for(o=0;o<e.data.length;o++){var a=e.data[o].attributes;switch(S.platform){case"shopify":x[a.shopifyVariantId]=a.contracts;break;case"bigcommerce":x[a.bcVariantId]=a.contracts;break;default:x[a.sku]=a.contracts}}U=!0,n(),M&&setTimeout(M,500)}else console.error("Something went wrong while loading contracts for products with config:"+this.status)}))},t=function(e){50<e.length&&(j&&console.warn("Contract load warning: Limiting contract load to the first 50 SKUs provided."),e=e.slice(0,50));var t=l+"/products/?includeConfig=true&sku="+e.join(",");a(t,function(){if(200<=this.status&&this.status<400)for(var e=JSON.parse(this.response),t=0;t<e.data.length;t++){var o=e.data[t].attributes;switch(S.platform){case"shopify":x[o.shopifyVariantId]=o.contracts;break;case"bigcommerce":x[o.bcVariantId]=o.contracts;break;default:x[o.sku]=o.contracts}}else console.error("Something went wrong while loading contracts for product list:"+this.status)})},J=function(t,o){var e=l+"/products/"+encodeURIComponent(t)+"/contracts";a(e,function(){if(200<=this.status&&this.status<400){var e=JSON.parse(this.response).data;x[t]=e}else switch(this.status){case 404:j&&console.warn("Clyde warning: contracts not found for sku "+t),x[t]=[];break;default:j&&console.warn("Clyde warning: something went wrong when trying to pull contracts for sku "+t)}"function"==typeof o&&o(x[t])})},_=function(){if(K&&S){if(k&&k.contracts&&0<k.contracts.length){switch(C){case"simple":h.style.height="55px";break;case"list":var e=40*k.contracts.length+5*(k.contracts.length-1)+70;h.style.height=e.toString()+"px";break;case"select":default:h.style.height="100%"}h.classList.add("clyde-fade-in"),k.sku&&r("action=impression&type=product_page&activeProduct="+k.sku)}else h.style.height="0",h.classList.remove("clyde-fade-in");Q("setConfig",S,"product"),Q("setActiveProduct",k,"product")}else g&&setTimeout(_,500)},D=function(){H&&S?(Q("setConfig",S,"modal"),Q("setActiveProduct",k,"modal")):setTimeout(D,500)},F=function(e,t,o){if(e){var a=document.querySelector(e);if(!a)return 50<++E?void console.error("Could not find selector to attach to"):void setTimeout(function(){F(e,t,o)},10);o||(h.style.display="block"),t&&-1<R.indexOf(t)&&(C=t,h.onload=function(){window.frames["clyde-widget-product-page-frame"].postMessage({type:"init",data:{type:C},origin:window.location.origin},p)}),a.appendChild(h)}},Y=function(e,t,o){var a,n,i;x[e]?x[e]&&0===x[e].length||((a=document.querySelector(t))?document.querySelector(t+" iframe[name^=clyde-cart]")?j&&console.warn("Selected element already contains a prompt "+t):(n="clyde-widget-cart-frame-"+ ++A,(i=document.createElement("iframe")).name=n,i.id=n,i.src=y,i.style.opacity=0,i.style.height="40px",i.style.width="100%",i.style.border="none",i.onload=function(){window.frames[n].postMessage({type:"init",data:{frameName:n,productSku:e},origin:window.location.origin},y)},a.appendChild(i),N[n]=o,r("action=impression&type=cart&activeProduct="+e)):j&&console.warn("Element not found with selector "+t)):J(e,function(){Y(e,t,o)})},B=function(e,t){var o;!k||k&&0===k.contracts.length?console.error("Cannot open modal with no active product or a product with no contracts"):(o=w?w.sku:k.contracts[0].attributes.sku,c(o),m.style.display="block",m.classList.add("clyde-fade-in"),m.focus(),k.sku&&r("action=impression&type=modal&activeProduct="+k.sku),"function"==typeof t&&(L=t),"function"==typeof e?e():"function"==typeof z&&z())},Q=function(e,t,o,a){var n=window.frames["clyde-widget-product-page-frame"],i=window.frames["clyde-widget-modal-frame"];switch(o){case"product":n&&n.postMessage({type:e,data:t},p);break;case"modal":i&&i.postMessage({type:e,data:t},f);break;case"cart":a&&window.frames[a]&&window.frames[a].postMessage({type:e,data:t},y);break;default:i&&i.postMessage({type:e,data:t},f),n&&n.postMessage({type:e,data:t},p)}},Z=function(e){var t,o,a,n=e.data;switch(n.type){case"selectContract":c(n.data.sku,n.source);break;case"deselectContract":switch(w=null,n.source){case"product":Q("deselectContract",n.data,"modal");break;case"modal":Q("deselectContract",n.data,"product");break;default:Q("deselectContract",n.data,"both")}break;case"openModal":B();break;case"openCartModal":t=n.data.frameName,o=n.data.productSku,i(o),"function"==typeof N[t]&&(a=N[t],s(null,a));break;case"decline":Q("deselectContract",n.data),w=null,Q("decline",n.data,"product"),d();break;case"addProtection":Q("addProtection",{},"product"),d();break;case"closeModal":d();break;case"initialized":return void("modal"===n.source?(H=!0,Q("setConfig",S,"modal"),k&&Q("setActiveProduct",k,"modal")):"product"===n.source?(K=!0,_()):"cart"===n.source&&(document.querySelector("#"+n.data.frameName).classList.add("clyde-fade-in"),Q("setConfig",S,"cart",n.data.frameName)));default:return}};return{init:function(e,t){if(O=!0,!e||!e.key)throw"Need Clyde store key";if(b=e.key,!document.body)throw j&&console.warn("Document body does not exist yet. Make sure to call Clyde.init after body has loaded.  Ideal location is right before the </body> tag."),"document.body does not yet exist";function o(){W(),X()}l="https://api.joinclyde.com",u="https://cdn.joinclyde.com",e.baseUrl&&(l=e.baseUrl),f=u+"/static/html/custom-modal.min.html",p=u+"/static/html/custom-productPage.min.html",y=u+"/static/html/custom-cart.min.html",n=l+"/ana","function"==typeof e.onShowModal&&(z=e.onShowModal),"function"==typeof e.onCloseModal&&(T=e.onCloseModal),"function"==typeof e.onSelectedContract&&(q=e.onSelectedContract),e.defaultSelector&&(g=e.defaultSelector),e.showWarnings&&(j=e.showWarnings),e.type&&-1<R.indexOf(e.type)&&(C=e.type),e.skuList&&"object"==typeof e.skuList&&(50<e.skuList.length&&(j&&console.warn("Contract load warning: Limiting contract load to the first 50 SKUs provided."),e.skuList=e.skuList.slice(0,50)),v=e.skuList),e.pageKey&&(I=e.pageKey),e.skipGeoIp&&(V=e.skipGeoIp),"function"==typeof t&&(M=t),setTimeout(function(){G(o)},100),window.addEventListener("message",Z,!1)},loadContractsForProduct:function(e){U?J(e,null):console.error("Clyde widget not ready yet, did you initialize?")},loadContractsForProductList:function(e){U?t(e):console.error("Clyde widget not ready yet, did you initialize?")},setActiveProduct:i,selectContract:c,getSelectedContract:function(){if(U)return w;console.error("Clyde widget not ready yet, did you initialize?")},getActiveProduct:function(){if(U)return k;console.error("Clyde widget not ready yet, did you initialize?")},appendSelector:F,appendToSelector:F,showModal:s,appendToSelectorWithSku:Y,getSettings:function(){if(U)return P;console.error("Clyde widget not ready yet, did you initialize?")},checkReady:function(){return U},checkInit:function(){return O}}}();